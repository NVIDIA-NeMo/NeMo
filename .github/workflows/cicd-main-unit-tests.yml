name: NeMo Unit Tests
on:
  workflow_call:
    inputs:
      test_to_run:
        required: true
        type: string

jobs:
  asr-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_ASR
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_ASR
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      TIMEOUT: 20
      IS_UNIT_TEST: true

  audio-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_Audio
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_Audio
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      TIMEOUT: 20
      IS_UNIT_TEST: true

  common-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_Common
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_Common
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      TIMEOUT: 20
      IS_UNIT_TEST: true

  llm-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_LLM
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_LLM
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      IS_UNIT_TEST: true

  vlm-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_VLM
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_VLM
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      IS_UNIT_TEST: true

  multimodal-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_Multimodal
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_Multimodal
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      IS_UNIT_TEST: true

  tts-tests:
    strategy:
      matrix:
        include:
          - script: L0_Unit_Tests_GPU_TTS
            runner: self-hosted-azure-gpus-1
          - script: L0_Unit_Tests_CPU_TTS
            runner: self-hosted-azure-cpu
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: ${{ matrix.runner }}
      SCRIPT: ${{ matrix.script }}
      IS_UNIT_TEST: true

  L0_Unit_Tests_GPU_Core:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-gpus-1
      TIMEOUT: 20
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_GPU_Core

  L0_Unit_Tests_GPU_Hydra:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-gpus-1
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_GPU_Hydra

  L0_Unit_Tests_GPU_Lightning:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_GPU_Lightning

  L0_Unit_Tests_GPU_Others:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-gpus-1
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_GPU_Others

  L0_Unit_Tests_CPU_Core:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-cpu
      TIMEOUT: 20
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_CPU_Core

  L0_Unit_Tests_CPU_Hydra:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-cpu
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_CPU_Hydra

  L0_Unit_Tests_CPU_Lightning:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-cpu
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_CPU_Lightning

  L0_Unit_Tests_CPU_Others:
    uses: ./.github/workflows/_test_template.yml
    with:
      RUNNER: self-hosted-azure-cpu
      IS_UNIT_TEST: true
      SCRIPT: L0_Unit_Tests_CPU_Others
